Code snippet taken from https://macrometa.zendesk.com/agent/tickets/1307